<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.possys.Order_service.Order_Mapper">
 	<select id="order_list" resultType="kr.or.possys.Order_service.Order">
		select table_order_id,
		table_order_num,
		table_order_end,
		table_order_date 
		from table_order
	</select>
 	<select id="order_modify_form" parameterType = "String" resultType="kr.or.possys.Order_service.Order">
		select table_order_id,
		table_order_num,
		table_order_end,
		table_order_date 
		from table_order
		where table_order_id = #{table_order_id}
	</select>
	
	 	<select id="order_detail" parameterType = "String" resultType="kr.or.possys.Order_service.Order">
		select table_order_id,
		menu_id,
		menu_name,
		order_detail_ea,
		order_detail_sum,
		order_detail_end
		from order_detail where table_order_id= #{table_order_id}
		</select>
		
		<select id="get_price" parameterType = "String" resultType="String">
		select
		menu_price
		from menu where menu_id= #{menu_id}
		</select>
		
	<update id="order_end_t" parameterType="String">
		update table_order
		set table_order_end = 'T'
		where table_order_id = #{table_order_id}
	</update>
	
	<update id="order_detail_end_t" parameterType="kr.or.possys.Order_service.Order">
		update order_detail
		set order_detail_end = 'T'
		where table_order_id = #{table_order_id}
		and menu_id = #{menu_id}
	</update>
	
	<update id="order_modify_action" parameterType="kr.or.possys.Order_service.Order">
		update order_detail
		set 
		where table_order_id = #{table_order_id}
	</update>
	
		<update id="order_detail_modify" parameterType="kr.or.possys.Order_service.Order">
		update order_detail
		set
		menu_name = #{menu_name},
		order_detail_ea = #{order_detail_ea},
		order_detail_sum = #{order_detail_sum}
		where table_order_id = #{table_order_id} and
		menu_id = #{menu_id}
		</update>
		
		<insert id="order_detail_insert" parameterType="kr.or.possys.Order_service.Order">
		insert into order_detail(
		table_order_id,
		menu_id,
		menu_name,
		order_detail_ea,
		order_detail_sum)
		values (
		#{table_order_id},
		#{menu_id},
		#{menu_name},
		#{order_detail_ea},
		#{order_detail_sum}
		)
		
		</insert>
		<delete id = "order_delete" parameterType = "String">
		delete from table_order where table_order_id=#{table_order_id}
		</delete>
		
		<delete id = "order_detail_delete" parameterType = "String">
		delete from order_detail where table_order_id=#{table_order_id}
		</delete>
		
		<select id="menu_list" resultType="kr.or.possys.Menu_service.Menu">
		select menu_id
		,menu_name
		,menu_cate
		,menu_price
		,menu_sprice
		,menu_sale
		,menu_kcal
		,newname
		from menu
		order by menu_id desc
		</select>
		
		<select id="order_fpm" parameterType = "String" resultType="kr.or.possys.Order_service.Order">
			select menu_id
			,food_id
			,menu_name
			,fpm_ea
			from food_per_menu 
			where menu_id = #{menu_id}
		</select>
		
		<select id="order_ep_order" parameterType = "String" resultType="kr.or.possys.Order_service.Order">
			select ep_order_id
			,food_id
			,ep_order_food_shelflife
			,food_nowquantity
			from ep_order_food_details
			where food_id = #{food_id}
			order by ep_order_food_shelflife asc;
		</select>
		
		<update id="order_ep_zero" parameterType="kr.or.possys.Order_service.Order">
		update ep_order_food_details
		set
		food_nowquantity = 0,
		ea_order_statement = '소진'
		where ep_order_id = #{ep_order_id}
		and food_id = #{food_id}
		</update>
		
		<update id="order_ep_plus" parameterType="kr.or.possys.Order_service.Order">
		update ep_order_food_details
		set
		food_nowquantity = #{food_sum}
		where ep_order_id = #{ep_order_id}
		and food_id = #{food_id}
		</update>
		
		<select id="order_count" resultType="kr.or.possys.Order_service.Order">
			select max(table_order_id) as order_count
			from order_detail
		</select>
</mapper>